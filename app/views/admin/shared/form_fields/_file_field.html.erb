<div data-controller="file-preview">
  <label class="block text-gray-700 font-medium mb-2">
    <%= column.name.titleize %>
    <% if required %>
      <span class="text-red-500 ml-1">*</span>
    <% end %>
  </label>

  <div class="flex items-center space-x-3">
    <label class="cursor-pointer bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded-lg shadow-sm transition">
      Choose File
      <%= f.file_field column.name,
          required: required,
          direct_upload: true,
          class: "hidden",
          data: { file_preview_target: "input", action: "change->file-preview#preview" } %>
    </label>

    <span data-file-preview-target="filename" class="text-gray-400 text-sm">
      <% if f.object.send(column.name).attached? %>
        <%= f.object.send(column.name).filename.to_s %>
      <% else %>
        No file chosen
      <% end %>
    </span>
  </div>

  <div class="mt-3">
    <% if f.object.send(column.name).attached? && f.object.send(column.name).image? %>
      <%= image_tag f.object.send(column.name).variant(resize_to_limit: [100, 100]),
          class: "rounded-lg shadow border max-h-24",
          data: { file_preview_target: "preview" } %>
    <% else %>
      <img data-file-preview-target="preview" class="hidden rounded-lg shadow border max-h-24" />
    <% end %>
  </div>
</div>
